
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>code notes</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        .page-container { display: flex; width: 100vw; height: 100vh; overflow: hidden; }
        .code-column { width: 45%; height: 100%; background: #1e1e1e; color: #dcdcdc; overflow-y: auto; padding: 20px; border-right: 1px solid #333; }
        .explain-column { width: 55%; height: 100%; background: #f8f9fa; overflow-y: auto; padding: 20px; }
        .code-block, .explain-block { margin-bottom: 30px; padding: 15px; border-radius: 8px; }
        .code-block { background: #2d2d2d; position: relative; }
        .explain-block { background: white; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .code-block h3 { color: #61afef; margin-bottom: 10px; font-size: 16px; }
        .explain-block h3 { color: #2d3748; margin-bottom: 10px; font-size: 16px; }
        .code-content { font-family: 'Consolas', monospace; font-size: 14px; line-height: 1.6; white-space: pre-wrap; }
        .explain-content { color: #4a5568; font-size: 14px; line-height: 1.8; }
        .save-btn { background: transparent; border: none; color: transparent;}
        .code-block.active { border: 2px solid #61afef; }
        .explain-block.active { border-left: 4px solid #61afef; background: #f0f8ff; }
        .header { padding: 10px 20px; background: #333; color: 333; text-align: center; }
        @media (max-width: 768px) { .page-container { flex-direction: column; } .code-column, .explain-column { width: 100%; height: 50%; } }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            border: 1px solid #ddd;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 12px 15px;
            text-align: left;
        }

        th {
            background-color: #3498db;
            color: white;
            font-weight: 600;
        }

        tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        tr:hover {
            background-color: #f1f8ff;
        }

        ul, ol {
            padding-left: 2em;
            margin: 1em 0;
        }

        li {
            margin: 0.5em 0;
        }

        hr {
            margin: 1.5em 0;
            border: none;
            border-top: 1px solid #ddd;
        }

        .explain-content h1, h2, h3, h4, h5, h6 {
          margin: 30px 0 15px 0;
        }

        .explain-content pre {
            background-color: #1e1e1e;
            border-radius: 6px;
            padding: 1em;
            margin: 1em 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .explain-content code {
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.5;
            color: #dcdcdc;
            white-space: inherit;
        }

        .code-content pre,
        .code-content code {
            background-color: transparent;
            border: none;
            padding: 0;
            color: inherit;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .explain-content h1 code,
        .explain-content h2 code,
        .explain-content h3 code,
        .explain-content h4 code,
        .explain-content td code,
        .explain-content p code,
        .explain-content li code {
            background-color: hsla(0, 0%, 80%, 0.0);
            color: #ff5956 !important;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="page-container">
<div class="code-column" id="codeColumn">
        <div class="code-block" data-id="block0" id="block0">
            <div class="code-content"></div>
        </div>

        <div class="code-block" data-id="block1" id="block1">
            <div class="code-content"></div>
        </div>

        <div class="code-block" data-id="block2" id="block2">
            <div class="code-content"></div>
        </div>

        <div class="code-block" data-id="block3" id="block3">
            <div class="code-content"></div>
        </div>

        <div class="code-block" data-id="block4" id="block4">
            <div class="code-content"></div>
        </div>

        <div class="code-block" data-id="block5" id="block5">
            <div class="code-content"></div>
        </div>

        <div class="code-block" data-id="block6" id="block6">
            <div class="code-content"></div>
        </div>
</div>
<div class="explain-column" id="explainColumn">
        <div class="explain-block" data-id="block0" id="explainBlock0">
            <div class="explain-content"></div>
        </div>

        <div class="explain-block" data-id="block1" id="explainBlock1">
            <div class="explain-content"></div>
        </div>

        <div class="explain-block" data-id="block2" id="explainBlock2">
            <div class="explain-content"></div>
        </div>

        <div class="explain-block" data-id="block3" id="explainBlock3">
            <div class="explain-content"></div>
        </div>

        <div class="explain-block" data-id="block4" id="explainBlock4">
            <div class="explain-content"></div>
        </div>

        <div class="explain-block" data-id="block5" id="explainBlock5">
            <div class="explain-content"></div>
        </div>

        <div class="explain-block" data-id="block6" id="explainBlock6">
            <div class="explain-content"></div>
        </div>
    </div>
</div>
    <script>
        const blockCodeContents = {
            block0 : `\`\`\`python
# vim: expandtab:ts=4:sw=4
import numpy as np


\`\`\`
`,
block1 : `\`\`\`python
def _pdist(a, b):
    """Compute pair-wise squared distance between points in \`a\` and \`b\`.

    Parameters
    ----------
    a : array_like
        An NxM matrix of N samples of dimensionality M.
    b : array_like
        An LxM matrix of L samples of dimensionality M.

    Returns
    -------
    ndarray
        Returns a matrix of size len(a), len(b) such that element (i, j)
        contains the squared distance between \`a[i]\` and \`b[j]\`.

    
    ç”¨äºè®¡ç®—æˆå¯¹ç‚¹ä¹‹é—´çš„å¹³æ–¹è·ç¦»
    a ï¼šNxM çŸ©é˜µï¼Œä»£è¡¨ N ä¸ªæ ·æœ¬ï¼Œæ¯ä¸ªæ ·æœ¬ M ä¸ªæ•°å€¼ 
    b ï¼šLxM çŸ©é˜µï¼Œä»£è¡¨ L ä¸ªæ ·æœ¬ï¼Œæ¯ä¸ªæ ·æœ¬æœ‰ M ä¸ªæ•°å€¼ 
    è¿”å›çš„æ˜¯ NxL çš„çŸ©é˜µï¼Œæ¯”å¦‚ dist[i][j] ä»£è¡¨ a[i] å’Œ b[j] ä¹‹é—´çš„å¹³æ–¹å’Œè·ç¦»
    å‚è€ƒï¼šhttps://blog.csdn.net/frankzd/article/details/80251042

    """
    a, b = np.asarray(a), np.asarray(b)
    if len(a) == 0 or len(b) == 0:
        return np.zeros((len(a), len(b)))
    a2, b2 = np.square(a).sum(axis=1), np.square(b).sum(axis=1)
    r2 = -2. * np.dot(a, b.T) + a2[:, None] + b2[None, :]
    r2 = np.clip(r2, 0., float(np.inf))
    return r2


\`\`\`
`,
block2 : `\`\`\`python
def _cosine_distance(a, b, data_is_normalized=False):
    """Compute pair-wise cosine distance between points in \`a\` and \`b\`.

    Parameters
    ----------
    a : array_like
        An NxM matrix of N samples of dimensionality M.
    b : array_like
        An LxM matrix of L samples of dimensionality M.
    data_is_normalized : Optional[bool]
        If True, assumes rows in a and b are unit length vectors.
        Otherwise, a and b are explicitly normalized to lenght 1.

    Returns
    -------
    ndarray
        Returns a matrix of size len(a), len(b) such that eleement (i, j)
        contains the squared distance between \`a[i]\` and \`b[j]\`.

    ç”¨äºè®¡ç®—æˆå¯¹ç‚¹ä¹‹é—´çš„ä½™å¼¦è·ç¦»
    a ï¼šNxM çŸ©é˜µï¼Œä»£è¡¨ N ä¸ªæ ·æœ¬ï¼Œæ¯ä¸ªæ ·æœ¬ M ä¸ªæ•°å€¼ 
    b ï¼šLxM çŸ©é˜µï¼Œä»£è¡¨ L ä¸ªæ ·æœ¬ï¼Œæ¯ä¸ªæ ·æœ¬æœ‰ M ä¸ªæ•°å€¼ 
    è¿”å›çš„æ˜¯ NxL çš„çŸ©é˜µï¼Œæ¯”å¦‚ c[i][j] ä»£è¡¨ a[i] å’Œ b[j] ä¹‹é—´çš„ä½™å¼¦è·ç¦»
    å‚è€ƒï¼š
    https://blog.csdn.net/u013749540/article/details/51813922
    

    """
    if not data_is_normalized:
        # np.linalg.norm æ±‚å‘é‡çš„èŒƒå¼ï¼Œé»˜è®¤æ˜¯ L2 èŒƒå¼ 
        a = np.asarray(a) / np.linalg.norm(a, axis=1, keepdims=True)
        b = np.asarray(b) / np.linalg.norm(b, axis=1, keepdims=True)
    return 1. - np.dot(a, b.T) # ä½™å¼¦è·ç¦» = 1 - ä½™å¼¦ç›¸ä¼¼åº¦


\`\`\`
`,
block3 : `\`\`\`python
def _nn_euclidean_distance(x, y):
    """ Helper function for nearest neighbor distance metric (Euclidean).

    Parameters
    ----------
    x : ndarray
        A matrix of N row-vectors (sample points).
    y : ndarray
        A matrix of M row-vectors (query points).

    Returns
    -------
    ndarray
        A vector of length M that contains for each entry in \`y\` the
        smallest Euclidean distance to a sample in \`x\`.

    """
    distances = _pdist(x, y)
    return np.maximum(0.0, distances.min(axis=0))


\`\`\`
`,
block4 : `\`\`\`python
def _nn_cosine_distance(x, y):
    """ Helper function for nearest neighbor distance metric (cosine).

    Parameters
    ----------
    x : ndarray
        A matrix of N row-vectors (sample points).
    y : ndarray
        A matrix of M row-vectors (query points).

    Returns
    -------
    ndarray
        A vector of length M that contains for each entry in \`y\` the
        smallest cosine distance to a sample in \`x\`.

    """
    distances = _cosine_distance(x, y)
    return distances.min(axis=0)


\`\`\`
`,
block5 : `\`\`\`python
class NearestNeighborDistanceMetric(object):
    """
    A nearest neighbor distance metric that, for each target, returns
    the closest distance to any sample that has been observed so far.

    å¯¹äºæ¯ä¸ªç›®æ ‡ï¼Œè¿”å›æœ€è¿‘é‚»å±…çš„è·ç¦»åº¦é‡, å³ä¸åˆ°ç›®å‰ä¸ºæ­¢å·²è§‚å¯Ÿåˆ°çš„ä»»ä½•æ ·æœ¬çš„æœ€æ¥è¿‘è·ç¦»ã€‚

    Parameters
    ----------
    metric : str
        Either "euclidean" or "cosine".
    matching_threshold: float
        The matching threshold. Samples with larger distance are considered an
        invalid match.
        åŒ¹é…é˜ˆå€¼ã€‚ è·ç¦»è¾ƒå¤§çš„æ ·æœ¬å¯¹è¢«è®¤ä¸ºæ˜¯æ— æ•ˆçš„åŒ¹é…ã€‚
    budget : Optional[int]
        If not None, fix samples per class to at most this number. Removes
        the oldest samples when the budget is reached.
        å¦‚æœä¸æ˜¯Noneï¼Œåˆ™å°†æ¯ä¸ªç±»åˆ«çš„æ ·æœ¬æœ€å¤šå›ºå®šä¸ºè¯¥æ•°å­—ã€‚ 
        åˆ é™¤è¾¾åˆ°budgetæ—¶æœ€å¤è€çš„æ ·æœ¬ã€‚

    Attributes
    ----------
    samples : Dict[int -> List[ndarray]]
        A dictionary that maps from target identities to the list of samples
        that have been observed so far.
        ä¸€ä¸ªä»ç›®æ ‡IDæ˜ å°„åˆ°åˆ°ç›®å‰ä¸ºæ­¢å·²ç»è§‚å¯Ÿåˆ°çš„æ ·æœ¬åˆ—è¡¨çš„å­—å…¸

    """

    def __init__(self, metric, matching_threshold, budget=None):


        if metric == "euclidean":
            self._metric = _nn_euclidean_distance # æ¬§å¼è·ç¦»
        elif metric == "cosine":
            self._metric = _nn_cosine_distance # ä½™å¼¦è·ç¦»
        else:
            raise ValueError(
                "Invalid metric; must be either 'euclidean' or 'cosine'")
        self.matching_threshold = matching_threshold
        self.budget = budget # budgeç”¨äºæ§åˆ¶ feature çš„æ•°ç›®
        self.samples = {}

    def partial_fit(self, features, targets, active_targets):
        """Update the distance metric with new data.
        ç”¨æ–°çš„æ•°æ®æ›´æ–°æµ‹é‡è·ç¦»

        Parameters
        ----------
        features : ndarray
            An NxM matrix of N features of dimensionality M.
        targets : ndarray
            An integer array of associated target identities.
        active_targets : List[int]
            A list of targets that are currently present in the scene.
        ä¼ å…¥ç‰¹å¾åˆ—è¡¨åŠå…¶å¯¹åº”idï¼Œpartial_fitæ„é€ ä¸€ä¸ªæ´»è·ƒç›®æ ‡çš„ç‰¹å¾å­—å…¸ã€‚

        """
        for feature, target in zip(features, targets):
            # å¯¹åº”ç›®æ ‡ä¸‹æ·»åŠ æ–°çš„featureï¼Œæ›´æ–°featureé›†åˆ
            # sampleså­—å…¸    d: feature list}
            self.samples.setdefault(target, []).append(feature)
            if self.budget is not None:
                # åªè€ƒè™‘budgetä¸ªç›®æ ‡ï¼Œè¶…è¿‡ç›´æ¥å¿½ç•¥
                self.samples[target] = self.samples[target][-self.budget:]
        
        # ç­›é€‰æ¿€æ´»çš„ç›®æ ‡ï¼›samplesæ˜¯ä¸€ä¸ªå­—å…¸{id->feature list}
        self.samples = {k: self.samples[k] for k in active_targets}

    def distance(self, features, targets):
        """Compute distance between features and targets.

        Parameters
        ----------
        features : ndarray
            An NxM matrix of N features of dimensionality M.
        targets : List[int]
            A list of targets to match the given \`features\` against.

        Returns
        -------
        ndarray
            Returns a cost matrix of shape len(targets), len(features), where
            element (i, j) contains the closest squared distance between
            \`targets[i]\` and \`features[j]\`.
        
        è®¡ç®—featureså’Œtargetsä¹‹é—´çš„è·ç¦»ï¼Œè¿”å›ä¸€ä¸ªæˆæœ¬çŸ©é˜µï¼ˆä»£ä»·çŸ©é˜µï¼‰
        """
        cost_matrix = np.zeros((len(targets), len(features)))
        for i, target in enumerate(targets):
            cost_matrix[i, :] = self._metric(self.samples[target], features)
        return cost_matrix

\`\`\`
`,
block6 : ``
        };

        const blockExplainContents = {
            block0 : `## ä»£ç åŠŸèƒ½æ¦‚è¿°

è¿™ä¸ªæ¨¡å—å®ç°äº†**æœ€è¿‘é‚»è·ç¦»åº¦é‡**ï¼Œç”¨äºè®¡ç®—æ£€æµ‹ç›®æ ‡ä¸ç°æœ‰è½¨è¿¹ä¹‹é—´çš„ç›¸ä¼¼åº¦ï¼Œæ˜¯DeepSORTç®—æ³•ä¸­æ•°æ®å…³è”çš„å…³é”®éƒ¨åˆ†ã€‚

## åŸºç¡€åŸç†çŸ¥è¯†

### å¤šç›®æ ‡è·Ÿè¸ªä¸­çš„æ•°æ®å…³è”

- **é—®é¢˜**ï¼šå¦‚ä½•å°†å½“å‰å¸§çš„æ£€æµ‹ç»“æœä¸ç°æœ‰è½¨è¿¹æ­£ç¡®åŒ¹é…
    
- **è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨è·ç¦»åº¦é‡è®¡ç®—ç›¸ä¼¼åº¦ï¼Œé€‰æ‹©æœ€åŒ¹é…çš„è½¨è¿¹
    
- **å¸¸ç”¨åº¦é‡**ï¼šæ¬§æ°è·ç¦»ã€ä½™å¼¦è·ç¦»
    

### ç‰¹å¾åŒ¹é…æµç¨‹

\`\`\`
å½“å‰å¸§æ£€æµ‹ç‰¹å¾ â†’ è·ç¦»è®¡ç®— â†’ ç°æœ‰è½¨è¿¹ç‰¹å¾åº“ â†’ åŒ¹é…å†³ç­–
\`\`\`
`,
block1 : `**æ•°å­¦åŸç†**ï¼ˆæ¬§æ°è·ç¦»å¹³æ–¹ï¼‰ï¼š

\`\`\`
è·ç¦»Â² = Î£(x_i - y_i)Â² 
      = Î£(x_iÂ² - 2x_iy_i + y_iÂ²)
      = Î£x_iÂ² + Î£y_iÂ² - 2Î£x_iy_i
\`\`\`
`,
block2 : `**æ•°å­¦åŸç†**ï¼š

\`\`\`
ä½™å¼¦ç›¸ä¼¼åº¦ = (AÂ·B) / (||A|| * ||B||)
ä½™å¼¦è·ç¦» = 1 - ä½™å¼¦ç›¸ä¼¼åº¦
\`\`\`
`,
block3 : `**è¿”å›yä¸­æ¯ä¸ªç‚¹ä¸xä¸­æœ€è¿‘ç‚¹çš„æœ€å°æ¬§æ°è·ç¦»**`,
block4 : `**è¿”å›yä¸­æ¯ä¸ªç‚¹ä¸xä¸­æœ€è¿‘ç‚¹çš„æœ€å°ä½™å¼¦è·ç¦»**`,
block5 : `### 1. åˆå§‹åŒ–æ–¹æ³•

\`\`\`
def __init__(self, metric, matching_threshold, budget=None):
    if metric == "euclidean":
        self._metric = _nn_euclidean_distance
    elif metric == "cosine":
        self._metric = _nn_cosine_distance
    self.matching_threshold = matching_threshold
    self.budget = budget
    self.samples = {}  # {target_id: [feature1, feature2, ...]}
\`\`\`

**å‚æ•°è¯´æ˜**ï¼š

- \`metric\`: è·ç¦»åº¦é‡ç±»å‹ï¼ˆ"euclidean"æˆ–"cosine"ï¼‰
    
- \`matching_threshold\`: åŒ¹é…é˜ˆå€¼ï¼Œè·ç¦»å¤§äºæ­¤å€¼è®¤ä¸ºä¸åŒ¹é…
    
- \`budget\`: æ¯ä¸ªç›®æ ‡æœ€å¤šä¿å­˜çš„ç‰¹å¾æ•°ï¼ˆé˜²æ­¢å†…å­˜æ— é™å¢é•¿ï¼‰
    

### 2. ç‰¹å¾æ›´æ–°æ–¹æ³• \`partial_fit\`

\`\`\`
def partial_fit(self, features, targets, active_targets):
    for feature, target in zip(features, targets):
        self.samples.setdefault(target, []).append(feature)
        if self.budget is not None:
            self.samples[target] = self.samples[target][-self.budget:]
    
    # åªä¿ç•™æ´»è·ƒç›®æ ‡çš„ç‰¹å¾
    self.samples = {k: self.samples[k] for k in active_targets}
\`\`\`

**å·¥ä½œæµç¨‹**ï¼š

\`\`\`
# ç¤ºä¾‹ä½¿ç”¨
features = [feat1, feat2, feat3]  # å½“å‰å¸§æ£€æµ‹ç‰¹å¾
targets = [1, 2, 1]               # å¯¹åº”çš„è½¨è¿¹ID
active_targets = [1, 2, 3]        # å½“å‰æ´»è·ƒçš„è½¨è¿¹

# æ›´æ–°åsampleså­—å…¸ï¼š
# {
#     1: [old_feat1, feat1, feat3],  # ID1æ–°å¢ä¸¤ä¸ªç‰¹å¾
#     2: [old_feat2, feat2]          # ID2æ–°å¢ä¸€ä¸ªç‰¹å¾
# }
# ID3ä¸åœ¨featuresä¸­ï¼Œä½†å› ä¸ºæ˜¯æ´»è·ƒç›®æ ‡ï¼Œä¿ç•™åŸæœ‰ç‰¹å¾
\`\`\`

#### self.samples = {k: self.samples[k] for k in active_targets}


è¿™ä¸ªè¯­å¥ä½¿ç”¨äº†å­—å…¸æ¨å¯¼å¼ï¼ˆDictionary Comprehensionï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„è¡¨æ ¼æ¥ç†è§£å…¶æ¯ä¸ªéƒ¨åˆ†çš„ä½œç”¨ï¼š

|ä»£ç ç‰‡æ®µ|è§£é‡Š|
|---|---|
|\`active_targets\`|ä¸€ä¸ªåˆ—è¡¨ï¼ŒåŒ…å«äº†å½“å‰å¸§ä¸­æ‰€æœ‰**å·²ç¡®è®¤**ï¼ˆconfirmedï¼‰çŠ¶æ€çš„è·Ÿè¸ªç›®æ ‡çš„ IDã€‚|
|\`for k in active_targets\`|éå† \`active_targets\`åˆ—è¡¨ä¸­çš„æ¯ä¸€ä¸ªç›®æ ‡ IDï¼ˆä½œä¸ºé”® \`k\`ï¼‰ã€‚|
|\`self.samples[k]\`|ä»åŸæœ‰çš„ç‰¹å¾å­—å…¸ \`self.samples\`ä¸­ï¼Œè·å–é”® \`k\`å¯¹åº”çš„å€¼ã€‚è¿™ä¸ªå€¼é€šå¸¸æ˜¯è¯¥ç›®æ ‡çš„å†å²å¤–è§‚ç‰¹å¾å‘é‡åˆ—è¡¨ã€‚|
|\`{k: self.samples[k] for ... }\`|æ„å»ºä¸€ä¸ªæ–°çš„å­—å…¸ï¼ŒåªåŒ…å«é‚£äº›é”® \`k\`å‡ºç°åœ¨ \`active_targets\`ä¸­çš„é”®å€¼å¯¹ã€‚|
|\`self.samples = ...\`|å°†æ–°ç”Ÿæˆçš„å­—å…¸é‡æ–°èµ‹å€¼ç»™ \`self.samples\`ï¼Œè¦†ç›–åŸæ¥çš„æ—§å­—å…¸ã€‚|

**é€šä¿—æ¥è®²**ï¼šè¿™è¡Œä»£ç å°±åƒä¸€æ¬¡â€œå¤§æ‰«é™¤â€ï¼Œæ£€æŸ¥ç‰¹å¾åº“ï¼ˆ\`self.samples\`ï¼‰é‡Œæ‰€æœ‰ä½æˆ·ï¼ˆç›®æ ‡ IDï¼‰ï¼Œåªç•™ä¸‹é‚£äº›å½“å‰ä»åœ¨å±‹é‡Œï¼ˆæ´»è·ƒç›®æ ‡ï¼‰çš„ä½æˆ·ä¿¡æ¯ï¼ŒæŠŠå·²ç»æ¬èµ°ï¼ˆè·Ÿè¸ªå¤±è´¥æˆ–ç›®æ ‡æ¶ˆå¤±ï¼‰çš„ä½æˆ·ä¿¡æ¯å…¨éƒ¨æ¸…ç†æ‰ã€‚

### ğŸ’¡ è®¾è®¡ç›®çš„ä¸åŸç†

åœ¨ DeepSORT ä¸­ï¼Œ\`self.samples\`æ˜¯ä¸€ä¸ªæ ¸å¿ƒæ•°æ®ç»“æ„ï¼Œç”¨äºå­˜å‚¨æ¯ä¸ªè·Ÿè¸ªç›®æ ‡çš„å†å²å¤–è§‚ç‰¹å¾ï¼ˆfeatureï¼‰ï¼Œå…¶å½¢å¼é€šå¸¸ä¸º \`{track_id: [feature1, feature2, ...]}\`ã€‚è¿™è¡Œä»£ç çš„è®¾è®¡ä¸»è¦åŸºäºä»¥ä¸‹ä¸¤ä¸ªé‡è¦åŸå› ï¼š

1. **ä¼˜åŒ–å†…å­˜å ç”¨**ï¼šè·Ÿè¸ªè¿‡ç¨‹æ˜¯åŠ¨æ€çš„ï¼Œç›®æ ‡ä¼šä¸æ–­å‡ºç°å’Œæ¶ˆå¤±ã€‚å¦‚æœä¸åŠæ—¶æ¸…ç†ï¼Œ\`self.samples\`å­—å…¸ä¼šè¶Šæ¥è¶Šå¤§ï¼Œä¿å­˜å¤§é‡æ— æ•ˆæ•°æ®ã€‚é€šè¿‡åªä¿ç•™æ´»è·ƒç›®æ ‡ï¼Œå¯ä»¥æœ‰æ•ˆæ§åˆ¶å†…å­˜æ¶ˆè€—ã€‚
    
2. **æå‡åŒ¹é…æ•ˆç‡**ï¼šåœ¨åç»­çš„å¸§ä¸­ï¼Œéœ€è¦è¿›è¡Œæ•°æ®å…³è”ï¼ˆå°†æ£€æµ‹æ¡†åŒ¹é…åˆ°å·²æœ‰çš„è·Ÿè¸ªè½¨è¿¹ï¼‰ã€‚è·ç¦»åº¦é‡ï¼ˆç”± \`NearestNeighborDistanceMetric\`ç±»è´Ÿè´£ï¼‰ä¼šè®¡ç®—å½“å‰æ£€æµ‹ç‰¹å¾ä¸ \`self.samples\`ä¸­æ‰€æœ‰ç‰¹å¾çš„è·ç¦»ã€‚æ¸…ç†æ‰éæ´»è·ƒç›®æ ‡åï¼Œå‚ä¸è®¡ç®—çš„æ ·æœ¬æ•°é‡å‡å°‘ï¼Œå¯ä»¥æ˜¾è‘—æé«˜åŒ¹é…é€Ÿåº¦ã€‚
    

è¿™ä¸ªæ“ä½œé€šå¸¸å‘ç”Ÿåœ¨æ¯æ¬¡è·Ÿè¸ªæ›´æ–°ï¼ˆ\`update\`ï¼‰çš„æœ€åé˜¶æ®µï¼Œåœ¨å®Œæˆäº†åŒ¹é…ã€åˆ›å»ºæ–°è½¨è¿¹ã€æ ‡è®°ä¸¢å¤±è½¨è¿¹ç­‰ä¸€ç³»åˆ—æ“ä½œåï¼Œè·å–å½“å‰æœ€æ–°çš„æ´»è·ƒç›®æ ‡åˆ—è¡¨ï¼Œç„¶åå¯¹ç‰¹å¾åº“è¿›è¡Œæ¸…ç†ã€‚

### 3. è·ç¦»è®¡ç®—æ ¸å¿ƒæ–¹æ³• \`distance\`

\`\`\`
def distance(self, features, targets):
    cost_matrix = np.zeros((len(targets), len(features)))
    for i, target in enumerate(targets):
        cost_matrix[i, :] = self._metric(self.samples[target], features)
    return cost_matrix
\`\`\`

**æˆæœ¬çŸ©é˜µç”Ÿæˆ**ï¼š

\`\`\`
å‡è®¾ï¼š
- targets = [1, 2]ï¼ˆä¸¤ä¸ªç°æœ‰è½¨è¿¹ï¼‰
- features = [f1, f2, f3]ï¼ˆä¸‰ä¸ªå½“å‰æ£€æµ‹ï¼‰

æˆæœ¬çŸ©é˜µç»“æ„ï¼š
        f1   f2   f3
è½¨è¿¹1  d11  d12  d13
è½¨è¿¹2  d21  d22  d23

å…¶ä¸­dij = è½¨è¿¹iä¸æ£€æµ‹jçš„æœ€å°è·ç¦»
\`\`\`
`,
block6 : `## å®é™…åº”ç”¨ç¤ºä¾‹

### åœ¨DeepSORTä¸­çš„å®Œæ•´ä½¿ç”¨æµç¨‹

\`\`\`
# åˆå§‹åŒ–è·ç¦»åº¦é‡å™¨
metric = NearestNeighborDistanceMetric(
    metric="cosine", 
    matching_threshold=0.2, 
    budget=100
)

# è·Ÿè¸ªå¾ªç¯
for frame in video_frames:
    # 1. æ£€æµ‹å½“å‰å¸§ç›®æ ‡
    detections = detector(frame)
    features = extractor.extract(detections)
    
    # 2. é¢„æµ‹ç°æœ‰è½¨è¿¹ä½ç½®
    tracks.predict()
    
    # 3. è®¡ç®—è·ç¦»æˆæœ¬çŸ©é˜µ
    active_targets = [t.track_id for t in tracks if t.is_confirmed()]
    cost_matrix = metric.distance(features, active_targets)
    
    # 4. æ•°æ®å…³è”ï¼ˆåŒˆç‰™åˆ©ç®—æ³•ç­‰ï¼‰
    matches, unmatched_detections, unmatched_tracks = matching(cost_matrix)
    
    # 5. æ›´æ–°è½¨è¿¹ç‰¹å¾åº“
    metric.partial_fit(features, matched_targets, active_targets)
\`\`\`

## å…³é”®æŠ€æœ¯åŸç†

### 1. Budgetæœºåˆ¶ï¼ˆç‰¹å¾åº“ç®¡ç†ï¼‰

\`\`\`
# é˜²æ­¢å†…å­˜æ— é™å¢é•¿
if self.budget is not None:
    self.samples[target] = self.samples[target][-self.budget:]
\`\`\`

- **é—®é¢˜**ï¼šé•¿æ—¶é—´è·Ÿè¸ªä¼šå¯¼è‡´ç‰¹å¾åº“æ— é™å¢é•¿
    
- **è§£å†³æ–¹æ¡ˆ**ï¼šæ¯ä¸ªç›®æ ‡åªä¿ç•™æœ€è¿‘Nä¸ªç‰¹å¾ï¼ˆFIFOï¼‰
    
- **å¹³è¡¡**ï¼šä¿å­˜è¶³å¤Ÿç‰¹å¾ä»¥é€‚åº”å¤–è§‚å˜åŒ–ï¼Œä½†ä¸å ç”¨è¿‡å¤šå†…å­˜
    

### 2. æœ€è¿‘é‚»åŒ¹é…ç­–ç•¥

\`\`\`
# ä¸æ˜¯è®¡ç®—å¹³å‡è·ç¦»ï¼Œè€Œæ˜¯æœ€å°è·ç¦»
min_distance = distances.min(axis=0)
\`\`\`

- **ä¼˜ç‚¹**ï¼šå¯¹éƒ¨åˆ†é®æŒ¡å’Œå¤–è§‚å˜åŒ–æ›´é²æ£’
    
- **åŸç†**ï¼šåªè¦æœ‰ä¸€ä¸ªå†å²ç‰¹å¾ä¸å½“å‰æ£€æµ‹ç›¸ä¼¼ï¼Œå°±è®¤ä¸ºåŒ¹é…
    

### 3. æ¿€æ´»ç›®æ ‡è¿‡æ»¤

\`\`\`
self.samples =k: self.samples[k] for k in active_targets}
\`\`\`

- **å†…å­˜ä¼˜åŒ–**ï¼šåªä¿ç•™å½“å‰æ´»è·ƒè½¨è¿¹çš„ç‰¹å¾
    
- **æ€§èƒ½æå‡**ï¼šå‡å°‘ä¸å¿…è¦çš„è·ç¦»è®¡ç®—
    `
        };

        // è·å–blockCodeContentsçš„itemå¤§å°
        const blockCodeContentsSize = Object.keys(blockCodeContents).length;
        console.log('blockCodeContentsçš„itemå¤§å°:', blockCodeContentsSize);

        window.addEventListener('DOMContentLoaded', function() {
            for (let i = 0; i < blockCodeContentsSize; i++) {
                const blockId = `block${i}`;
                const explainBlockId = `explainBlock${i}`;
                document.getElementById(blockId).querySelector('.code-content').innerHTML = marked.parse(blockCodeContents[blockId]);
                document.getElementById(explainBlockId).querySelector('.explain-content').innerHTML = marked.parse(blockExplainContents[blockId]);
            }
        });

        const codeColumn = document.getElementById('codeColumn');
    codeColumn.addEventListener('scroll', () => {
        let active = null;
        document.querySelectorAll('.code-block').forEach(block => {
            const rect = block.getBoundingClientRect();
            if (rect.top <= 200 && rect.bottom >= 200) active = block;
        });
        document.querySelectorAll('.code-block, .explain-block').forEach(el => el.classList.remove('active'));
        if (active) {
            active.classList.add('active');
            document.querySelector(`.explain-block[data-id="${active.dataset.id}"]`).classList.add('active');
        }
    });

    document.getElementById('saveButton').addEventListener('click', function() {
        const htmlContent = document.documentElement.outerHTML;
        const blob = new Blob([htmlContent], { type: 'text/html' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        const currentPath = window.location.pathname;
        const originalFileName = currentPath.split(/[\\/]/).pop();
        const fileName = originalFileName
                             ? (originalFileName.endsWith('.html') ? originalFileName : `${originalFileName}.html`)
                             : 'code_notes.html';
        a.download = fileName;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(a.href);

        this.textContent = 'save success';
        setTimeout(() => this.textContent = 'save context', 1500);
    });
    </script>
        </body>
        </html>