<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INI配置文件自动读取器</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: #333;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 800px;
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(90deg, #4b6cb7 0%, #182848 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        
        .subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .content {
            padding: 20px;
        }
        
        .status {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 5px;
            background: #f0f8ff;
        }
        
        .status-icon {
            font-size: 1.5rem;
            margin-right: 10px;
        }
        
        .status-loading {
            color: #ffa500;
        }
        
        .status-success {
            color: #28a745;
        }
        
        .status-error {
            color: #dc3545;
        }
        
        .file-info {
            font-weight: 500;
            color: #4b6cb7;
        }
        
        .config-display {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            border: 1px solid #eaeaea;
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 15px;
        }
        
        .section {
            margin-bottom: 15px;
        }
        
        .section-header {
            font-weight: bold;
            color: #4b6cb7;
            margin-bottom: 5px;
            padding-bottom: 5px;
            border-bottom: 1px solid #ddd;
        }
        
        .property {
            display: flex;
            margin: 5px 0;
            padding-left: 10px;
        }
        
        .property-name {
            font-weight: 500;
            min-width: 150px;
        }
        
        .property-value {
            color: #555;
        }
        
        .error-message {
            color: #d73a49;
            background: #ffebee;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            display: none;
        }
        
        .instructions {
            background: #e8f4f8;
            padding: 10px;
            border-radius: 5px;
            margin-top: 15px;
            font-size: 0.8rem;
        }
        
        .instructions h3 {
            color: #0c5460;
            margin-bottom: 5px;
        }
        
        .instructions ul {
            padding-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 3px;
        }
        
        .raw-content {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            margin-top: 15px;
            font-family: monospace;
            white-space: pre-wrap;
            font-size: 0.9rem;
            display: none;
        }
        
        .toggle-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 0.8rem;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .toggle-btn:hover {
            background: #5a6268;
        }
        
        @media (max-width: 600px) {
            .container {
                max-width: 100%;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .property {
                flex-direction: column;
            }
            
            .property-name {
                min-width: auto;
                margin-bottom: 3px;
            }
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            margin-right: 10px;
            display: inline-block;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>INI配置文件自动读取器</h1>
            <p class="subtitle">自动加载并显示同目录下的config.ini文件</p>
        </header>
        
        <div class="content">
            <div class="status" id="status">
                <div class="spinner"></div>
                <div class="file-info" id="fileInfo">正在加载config.ini文件...</div>
            </div>
            
            <div class="config-display" id="configDisplay">
                <p style="text-align: center; color: #888;">配置文件内容将显示在这里</p>
            </div>
            
            <button class="toggle-btn" id="toggleRaw">显示原始内容</button>
            <div class="raw-content" id="rawContent"></div>
            
            <div class="error-message" id="errorMessage"></div>
            
            <div class="instructions">
                <h3>使用说明</h3>
                <ul>
                    <li>页面加载时会自动尝试读取同目录下的config.ini文件</li>
                    <li>如果文件不存在或读取失败，会显示错误信息</li>
                    <li>支持标准的INI文件格式</li>
                    <li>文件内容将按节(section)和属性(property)格式化显示</li>
                    <li>点击"显示原始内容"可以查看文件的原始文本</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const status = document.getElementById('status');
            const fileInfo = document.getElementById('fileInfo');
            const configDisplay = document.getElementById('configDisplay');
            const errorMessage = document.getElementById('errorMessage');
            const rawContent = document.getElementById('rawContent');
            const toggleRaw = document.getElementById('toggleRaw');
            
            let showRaw = false;
            
            // 切换显示原始内容
            toggleRaw.addEventListener('click', function() {
                showRaw = !showRaw;
                if (showRaw) {
                    rawContent.style.display = 'block';
                    toggleRaw.textContent = '隐藏原始内容';
                } else {
                    rawContent.style.display = 'none';
                    toggleRaw.textContent = '显示原始内容';
                }
            });
            
            // 自动加载config.ini文件
            loadConfigFile();
            
            // 加载配置文件
            async function loadConfigFile() {
                try {
                    // 尝试使用fetch加载config.ini文件
                    const response = await fetch('config.ini');
                    
                    if (!response.ok) {
                        throw new Error(`HTTP错误: ${response.status}`);
                    }
                    
                    const content = await response.text();
                    
                    // 更新状态
                    status.innerHTML = '<span class="status-icon status-success">✓</span>';
                    fileInfo.textContent = '成功加载config.ini文件';
                    status.classList.add('status-success');
                    
                    // 解析并显示INI内容
                    parseAndDisplayINI(content);
                    
                    // 显示原始内容
                    rawContent.textContent = content;
                    
                } catch (error) {
                    // 处理错误
                    handleError(error);
                }
            }
            
            // 解析INI文件内容并显示
            function parseAndDisplayINI(content) {
                const lines = content.split('\n');
                let currentSection = '全局设置';
                const config = { [currentSection]: {} };
                
                // 解析INI文件
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    
                    // 跳过空行和注释
                    if (line === '' || line.startsWith(';') || line.startsWith('#')) {
                        continue;
                    }
                    
                    // 检查是否是节(section)
                    if (line.startsWith('[') && line.endsWith(']')) {
                        currentSection = line.substring(1, line.length - 1);
                        config[currentSection] = {};
                    } 
                    // 检查是否是属性(property)
                    else if (line.includes('=')) {
                        const equalsIndex = line.indexOf('=');
                        const key = line.substring(0, equalsIndex).trim();
                        const value = line.substring(equalsIndex + 1).trim();
                        
                        // 移除值两端的引号（如果存在）
                        const cleanValue = value.replace(/^["']|["']$/g, '');
                        
                        config[currentSection][key] = cleanValue;
                    }
                }
                
                // 显示解析结果
                displayConfig(config);
            }
            
            // 显示配置内容
            function displayConfig(config) {
                let html = '';
                
                for (const section in config) {
                    if (Object.keys(config[section]).length === 0) continue;
                    
                    html += `<div class="section">`;
                    html += `<div class="section-header">[${section}]</div>`;
                    
                    for (const key in config[section]) {
                        html += `<div class="property">`;
                        html += `<div class="property-name">${key}</div>`;
                        html += `<div class="property-value">${config[section][key]}</div>`;
                        html += `</div>`;
                    }
                    
                    html += `</div>`;
                }
                
                // 如果没有解析到任何内容，显示原始内容
                if (html === '') {
                    html = '<p style="text-align: center; color: #888;">配置文件为空或格式不正确</p>';
                }
                
                configDisplay.innerHTML = html;
            }
            
            // 处理错误
            function handleError(error) {
                status.innerHTML = '<span class="status-icon status-error">✗</span>';
                fileInfo.textContent = '加载config.ini文件失败';
                status.classList.add('status-error');
                
                errorMessage.textContent = `错误: ${error.message}`;
                errorMessage.style.display = 'block';
                
                configDisplay.innerHTML = `
                    <div style="text-align: center; margin-bottom: 15px;">
                        <p style="color: #dc3545; font-weight: 500;">无法加载配置文件</p>
                        <p style="font-size: 0.9rem; color: #666;">请确保config.ini文件与HTML文件在同一目录下</p>
                    </div>
                    <div style="background: #f0f0f0; padding: 10px; border-radius: 5px; font-family: monospace; white-space: pre-wrap; font-size: 0.9rem;">
; 这是一个示例配置文件格式
[Database]
host = localhost
port = 3306
username = admin

[Application]
name = "我的应用"
version = 1.0.0
                    </div>
                `;
                
                // 隐藏切换按钮
                toggleRaw.style.display = 'none';
            }
        });
    </script>
</body>
</html>
